<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Book Collection</title>
<link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <h1>Srushti's Digital Library</h1>

    <h3>Store your books in TBR</h3>
<nav>
  <button class="tbr-button"><a href="/tbr">To Be Read (TBR) List</a></button>
</nav>

    
    <!-- Book Adding Form -->

    <form id="isbnForm">
  <label for="isbn">Enter ISBN to autofill book data:</label>
  <input type="text" id="isbnInput" name="isbn" />
  <button type="submit">Fetch and Add Book</button>
</form>

<script>
  const form = document.getElementById('isbnForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const isbn = document.getElementById('isbnInput').value.trim();

    if (!isbn) {
      alert("Please enter an ISBN");
      return;
    }

    // Send fetch request to your backend API to add book by ISBN
    try {
      const response = await fetch('/books/add-by-isbn', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ isbn }),
      });

      if (response.ok) {
        alert("Book added!");
        window.location.reload(); // Refresh page to see new book
      } else {
        alert("Failed to add book");
      }
    } catch (error) {
      alert("Error contacting server");
      console.error(error);
    }
  });
</script>


    <form action="/books/add" method="POST">
      <label for="title">Book Title*</label>
      <input type="text" name="title" id="title" required placeholder="Enter book title" />
      
      <label for="author">Author*</label>
      <input type="text" name="author" id="author" required placeholder="Enter author's name" />
      
      <label for="isbn">ISBN</label>
      <input type="text" name="isbn" id="isbn" placeholder="Enter ISBN number" />
      
      <label for="cover_url">Cover Image URL</label>
      <input type="text" name="cover_url" id="cover_url" placeholder="Enter URL of the book cover" />
      
      <label for="rating">Rating (1 to 5) *</label>
      <input type="number" name="rating" id="rating" min="1" max="5" required />
      
      <label for="review">Review</label>
      <textarea name="review" id="review" placeholder="Write your review"></textarea>
      
      <button type="submit">Add Book</button>
    </form>

    <h2>Total books read: <%= totalBooks %></h2>
  <div class="books-list">

  <% if (books.length === 0) { %>
    <p>No books added yet.</p>
  <% } %>

  <% books.forEach(book => { %>
    <div class="book-card">
      <% if (book.cover_url) { %>
        <img class="book-cover" src="<%= book.cover_url %>" alt="Cover of <%= book.title %>" />
      <% } else { %>
        <div class="book-cover" style="background:#bdd7ff;display:flex;align-items:center;justify-content:center;color:#6588c3;">
          No Image
        </div>
      <% } %>

      <div class="book-title"><%= book.title %></div>
      <div class="book-author">by <%= book.author %></div>
      <div class="book-rating">Rating: <%= book.rating %> / 5</div>
      <% if (book.review) { %>
        <div class="book-review">"<%= book.review %>"</div>
      <% } %>

      <div style="margin-top: 1rem;">
        <button class="delete-button"><a href="/books/edit/<%= book.id %>">Edit</a></button> | 
        <button class="delete-button" type="submit" onclick="return confirm('Are you sure you want to delete this book?');"><a href="/books/delete/<%= book.id %>">Delete</a></button> 
        <!-- <form action="/books/delete/<%= book.id %>" method="POST" style="display:inline;">
          <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');" class="delete-button">Delete</button>
        </form> -->
      </div>

      <br />

      <!-- Online shopping links -->
      <button class="buy-button">  <a href="https://www.amazon.in/s?k=<%= encodeURIComponent(book.title + ' ' + book.author) %>" target="_blank" style="margin-right:10px;">
        Buy on Amazon
      </a></button>
      <button class="buy-button"><a href="https://www.flipkart.com/search?q=<%= encodeURIComponent(book.title + ' ' + book.author) %>" target="_blank">
        Buy on Flipkart
      </a></button>
    </div>
  <% }) %>
</div>

</div>

  </div>
</body>
</html>
